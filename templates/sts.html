<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DANSO TERMINAL PRO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/danso_logo.png') }}">
    
 <style>
        /* ==========================================================================
           DANSO TERMINAL PRO - macOS SILVER & WEBULL GLASS UI THEME (MERGED)
           ========================================================================== */

        :root {
            /* --- Palette: Apple Silver & Aluminum --- */
            --app-bg-grad: linear-gradient(180deg, #F5F5F7 0%, #E5E5EA 100%);
            --panel-glass: rgba(255, 255, 255, 0.65);
            --panel-border: rgba(255, 255, 255, 0.6);
            --panel-border-inner: rgba(0, 0, 0, 0.05);
            
            /* --- Colors: Financial & UI --- */
            --text-primary: #1D1D1F;
            --text-secondary: #86868B;
            --text-tertiary: #AEAEB2;
            --accent-blue: #0071E3;
            --accent-blue-dim: rgba(0, 113, 227, 0.1);
            --accent-green: #34C759;
            --accent-red: #FF3B30;
            
            /* --- Shadows --- */
            --shadow-depth-1: 0 1px 3px rgba(0,0,0,0.06);
            --shadow-depth-2: 0 4px 12px rgba(0, 0, 0, 0.08);
            --glass-blur: blur(25px);
            
            --font-stack: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Inter", sans-serif;
            --font-mono: "SF Mono", "JetBrains Mono", monospace;
        }

        /* --- Global Reset --- */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-font-smoothing: antialiased; }
        
        body {
            background: var(--app-bg-grad);
            font-family: var(--font-stack);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* --- Scrollbar --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.15); border-radius: 10px; }

        /* ==========================================================================
           NAVIGATION BAR
           ========================================================================== */
        nav {
            height: 56px;
            background: rgba(245, 245, 247, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 20px;
            z-index: 100; position: relative;
        }
        .logo-area { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 18px; color: var(--text-primary); }
        .logo-area img { height: 28px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
        .pro-badge { background: linear-gradient(135deg, #0071E3, #5E5CE6); color: white; padding: 3px 8px; border-radius: 12px; font-size: 9px; margin-left: 5px; }

        .nav-right { display: flex; gap: 12px; align-items: center; }
        .ai-filter-group { background: rgba(255,255,255,0.5); padding: 4px 8px; border-radius: 8px; display: flex; align-items: center; gap: 8px; border: 1px solid rgba(0,0,0,0.06); }
        .ai-filter-group input { width: 40px; border: 1px solid rgba(0,0,0,0.1); border-radius: 6px; text-align: center; font-family: var(--font-mono); font-weight: 600; background: #fff; }
        .ai-filter-group button { background: #fff; border: 1px solid rgba(0,0,0,0.1); border-radius: 6px; cursor: pointer; padding: 4px 8px; font-weight: 600; font-size: 11px; }
        .user-pill { display: flex; align-items: center; gap: 8px; }
        .user-pill img { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.15); }

        /* ==========================================================================
           MAIN LAYOUT (3-Column Grid) - [핵심: 이 부분이 레이아웃을 잡습니다]
           ========================================================================== */
        .layout-container {
            display: grid;
            grid-template-columns: 280px 1fr 320px; /* 좌:280, 중:자동, 우:320 */
            height: calc(100vh - 56px);
            gap: 16px;
            padding: 16px;
            max-width: 1920px; margin: 0 auto;
        }

        /* Panels Common Glass Style */
        .panel, .right-sub-panel, .chart-section, .indicator-section {
            background: var(--panel-glass);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--panel-border);
            border-radius: 16px;
            box-shadow: var(--shadow-depth-2);
            position: relative;
            display: flex; flex-direction: column; overflow: hidden;
        }
        
        .panel-header {
            height: 48px;
            padding: 0 16px;
            border-bottom: 1px solid var(--panel-border-inner);
            display: flex; align-items: center; justify-content: space-between;
            font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase;
        }

        /* --- Left Column: Scanner (Updated Design) --- */
        .scanner-panel { grid-column: 1; }
        #ticker-list-container { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 10px; }

        /* 1. 카드 전체 틀 */
        .ticker-row {
           display: flex;
           justify-content: space-between;
           align-items: center;
           padding: 12px 14px;
           background: linear-gradient(135deg, rgba(255, 255, 255, 0.6) 0%, rgba(245, 245, 247, 0.6) 100%);
           border: 1px solid rgba(255, 255, 255, 0.8);
           border-radius: 14px;
           cursor: pointer;
           transition: all 0.2s ease;
           box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .ticker-row:hover {
           background: #fff;
           transform: translateY(-2px);
           box-shadow: 0 6px 12px rgba(0,0,0,0.06);
           z-index: 10;
        }
        /* 선택된 항목 */
        .ticker-row.active {
           border: 2px solid #007AFF;
           background: #fff;
        }

        /* 2. 80점 이상 고득점(High Score) 스타일 */
        .ticker-row.high-score {
           background: linear-gradient(135deg, rgba(0, 113, 227, 0.08) 0%, rgba(94, 92, 230, 0.06) 100%);
           border: 1px solid rgba(0, 113, 227, 0.15);
        }

        /* 3. 내부 레이아웃 (왼쪽/오른쪽 분리) */
        .ticker-left { display: flex; flex-direction: column; gap: 4px; align-items: flex-start; }
        .ticker-right { display: flex; flex-direction: column; gap: 4px; align-items: flex-end; }

        /* 4. 텍스트 및 배지 스타일 */
        .t-symbol { font-weight: 700; font-size: 15px; color: #1D1D1F; }
        .t-price { font-family: "JetBrains Mono", monospace; font-weight: 600; font-size: 15px; color: #1D1D1F; }

        /* 점수 배지 */
        .t-score-badge {
            display: inline-flex; padding: 3px 8px; border-radius: 8px;
            font-size: 10px; font-weight: 600; 
            background: rgba(0,0,0,0.05); color: #666;
        }
        .ticker-row.high-score .t-score-badge {
            background: rgba(0, 122, 255, 0.15); color: #007AFF;
        }

        /* [Scanner Feed] 등락률 배지 디자인 */
        .t-change-badge {
             display: inline-flex; 
             align-items: center; justify-content: center;
             padding: 4px 8px; 
             border-radius: 6px; /* 약간 각진 둥근모서리 */
             font-size: 12px; font-weight: 700; 
             min-width: 60px;
             font-family: "JetBrains Mono", monospace;
        }
        /* 등락률 색상 클래스 */
        .t-change-badge.up { background: rgba(52, 199, 89, 0.15); color: #34C759; }
        .t-change-badge.down { background: rgba(255, 59, 48, 0.15); color: #FF3B30; }
        .t-change-badge.flat { background: rgba(0,0,0,0.05); color: #86868B; }

        .scanner-footer { padding: 12px; background: rgba(255,255,255,0.3); font-size: 11px; font-weight: 500; color: var(--text-secondary); border-top: 1px solid rgba(0,0,0,0.05); }

        /* --- Center Column: Chart & Stats --- */
        .center-col { grid-column: 2; display: flex; flex-direction: column; gap: 16px; overflow: hidden; }
        
        .chart-section { 
            flex: 65; 
            background: #fff; 
            box-shadow: var(--shadow-depth-2);
            display: flex;
            flex-direction: column;
            min-height: 400px;
        }
        .chart-overlay {
            position: absolute; top: 20px; left: 20px; z-index: 10;
            background: rgba(255,255,255,0.8); backdrop-filter: blur(8px);
            padding: 8px 16px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.05);
            box-shadow: var(--shadow-depth-1);
        }

        .indicator-section { flex: 35; }
        .metrics-grid {
            flex: 1; display: grid; grid-template-columns: repeat(6, 1fr);
            gap: 1px; background: rgba(0,0,0,0.06); border-top: 1px solid rgba(0,0,0,0.06); overflow-y: auto;
        }
        .metric-cell {
            background: rgba(255,255,255,0.85); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 8px; transition: 0.2s;
        }
        .metric-cell:hover { background: #fff; z-index: 1; }
        .metric-label { font-size: 9px; color: var(--text-tertiary); font-weight: 600; margin-bottom: 4px; text-transform: uppercase; }
        .metric-value { font-family: var(--font-mono); font-size: 15px; font-weight: 600; color: var(--text-primary); }
        .metric-cell.featured .metric-value { color: var(--accent-blue); font-size: 18px; font-weight: 700; }

        /* --- Right Column: Signals & Chat --- */
        .right-panel { grid-column: 3; display: flex; flex-direction: column; gap: 16px; overflow: hidden; }
        .right-sub-panel { flex: 1; }
        
        #signal-feed-container, #community-feed-container { flex: 1; overflow-y: auto; padding: 12px; }
        .signal-item {
            background: #fff; border: 1px solid rgba(0,0,0,0.04); border-radius: 12px;
            padding: 12px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .signal-header { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .signal-action { font-size: 9px; padding: 2px 6px; border-radius: 4px; font-weight: 700; text-transform: uppercase; }
        .signal-action.buy { background: rgba(52, 199, 89, 0.15); color: var(--accent-green); }
        
        .chat-input-area { padding: 12px; background: #fff; border-top: 1px solid rgba(0,0,0,0.05); display: flex; gap: 8px; }
        .chat-input { flex: 1; background: #F5F5F7; border: none; padding: 10px 14px; border-radius: 20px; font-size: 13px; }
        .chat-btn { width: 36px; height: 36px; border-radius: 50%; background: var(--accent-blue); color: white; border: none; cursor: pointer; box-shadow: 0 2px 8px rgba(0, 113, 227, 0.4); }

        /* Utility */
        .live-indicator { width: 6px; height: 6px; background: var(--accent-green); border-radius: 50%; box-shadow: 0 0 8px var(--accent-green); display: inline-block; margin-right: 6px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        /* 기존 코드의 약 215라인 쯤에 있는 미디어 쿼리 수정 */
        @media (max-width: 1024px) {
        /* [핵심 수정] 모바일에서는 body의 고정을 풀어야 스크롤이 됨 */
        body {
           height: auto !important;       /* 고정 높이 해제 */
           overflow-y: auto !important;   /* 세로 스크롤 허용 */
           -webkit-overflow-scrolling: touch; /* 아이폰 등에서 부드러운 스크롤 */
        }

        .layout-container { 
            display: flex; 
            flex-direction: column; 
            height: auto; 
            overflow-y: visible; 
            padding-bottom: 40px; /* 맨 아래 여백 확보 */
        }
    
        .center-col { min-height: 500px; }
    
        /* [추가 팁] 모바일에서 패널들 간격 조정 */
        .panel, .right-sub-panel {
            overflow: visible; /* 내부 스크롤 대신 전체 스크롤 사용 */
            height: auto;      /* 내용만큼 늘어나게 */
            flex: none;        /* 강제 비율 무시 */
        }
    
    /* [NEW] Webull 스타일 색상 유틸리티 */
        .text-up { color: #00C076 !important; font-weight: 700; } /* 상승: 초록 */
        .text-down { color: #FF3B30 !important; font-weight: 700; } /* 하락: 빨강 */
        .text-flat { color: #333333 !important; font-weight: 600; } /* 보합: 검정 */
        .text-blue { color: #007AFF !important; font-weight: 800; } /* 강조: 파랑 */
    }
    </style>   
</head>
<body>

    <nav>
        <div class="logo-area">
            <img src="{{ url_for('static', filename='images/danso_logo.png') }}" alt="DANSO Logo">
            <span>DANSO</span>
            <span class="pro-badge" style="background:linear-gradient(135deg, #007AFF, #AF52DE); color:white; padding:2px 6px; border-radius:4px; font-size:10px;">PRO</span>
        </div>
        
        <div class="nav-right" style="display:flex; gap:16px; align-items:center;">
            <div class="ai-filter-group" style="background:rgba(255,255,255,0.7); padding:6px 12px; border-radius:10px;">
                <span style="font-size:12px; font-weight:600;">AI Filter:</span>
                <input type="number" id="min-score-input" value="80" style="width:40px; border:none; background:transparent; font-weight:bold; text-align:center;">
                <button id="save-score-btn" style="background:#007AFF; color:white; border:none; border-radius:4px; cursor:pointer;">SET</button>
                <button id="subscribe-btn" style="background:transparent; border:none; cursor:pointer;"><i class="fa-regular fa-bell"></i> Alerts</button>
            </div>

            <div class="user-pill" style="display:flex; align-items:center; gap:8px;">
                <img src="https://ui-avatars.com/api/?name=Trader&background=007AFF&color=fff" alt="User Avatar" style="width:28px; height:28px; border-radius:50%;">
                <span style="font-size:13px; font-weight:600;">Trader</span>
            </div>
        </div>
    </nav>

    <div class="layout-container">

        <aside class="panel scanner-panel">
            <div class="panel-header" style="padding:12px 16px; font-size:11px; font-weight:700; color:#6E6E73; border-bottom:1px solid rgba(0,0,0,0.08); display:flex; justify-content:space-between;">
                <span>Scanner Feed</span>
                <i class="fa-solid fa-bolt" style="color:var(--blue-accent);"></i>
            </div>
            
            <div id="ticker-list-container">
                <div style="padding:50px 20px; text-align:center; color:#999;">
                    <i class="fa-solid fa-circle-notch fa-spin"></i><br><br>
                    Waiting for engine...
                </div>
            </div>
            
            <div class="scanner-footer" style="padding:10px; font-size:11px; color:#888; border-top:1px solid rgba(0,0,0,0.08);">
                <span id="scan-status-text">Status: Idle</span> | 
                <span id="scan-watching-count">0 Targets</span>
            </div>
        </aside>

        <div class="center-col">
            <div class="chart-section" id="chart-container">
                <div class="chart-overlay" style="position:absolute; top:16px; left:20px; z-index:10;">
                    <span id="overlay-ticker" style="font-size:24px; font-weight:800;">SELECT TICKER</span>
                    <span id="overlay-price" style="font-family:'JetBrains Mono'; font-size:20px; color:var(--green-accent);">--</span>
                </div>
            </div>

            <div class="indicator-section panel">
                <div class="panel-header" style="padding:12px 16px; font-size:11px; font-weight:700; color:#6E6E73; border-bottom:1px solid rgba(0,0,0,0.08);">
                    <span>Key Statistics</span>
                    <span class="status-badge" style="background:#eee; padding:2px 6px; border-radius:4px; float:right;">REAL-TIME</span>
                </div>
<div class="metrics-grid">
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">OBI</span><span class="metric-value" id="ind-obi">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">OBI MOM</span><span class="metric-value" id="ind-obi-mom">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">VPIN</span><span class="metric-value" id="ind-vpin">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">Tick Speed</span><span class="metric-value" id="ind-tick-speed">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">Tick Accel</span><span class="metric-value" id="ind-tick-accel">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">VWAP Dist</span><span class="metric-value" id="ind-vwap-dist">--</span></div>
    
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">VWAP Slope</span><span class="metric-value" id="ind-vwap-slope">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">Squeeze</span><span class="metric-value" id="ind-squeeze">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">RVOL</span><span class="metric-value" id="ind-rvol">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">ATR</span><span class="metric-value" id="ind-atr">--</span></div>

    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">RSI (14s)</span><span class="metric-value" id="ind-rsi">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">Stoch %K</span><span class="metric-value" id="ind-stoch">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">Fibo Pos</span><span class="metric-value" id="ind-fibo">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">OBI Rev</span><span class="metric-value" id="ind-obi-rev">--</span></div>

    <div class="metric-cell" style="background:#F2F8FF;"><span class="metric-label" style="font-size:10px; color:#007AFF;">Hybrid Score</span><span class="metric-value" id="ind-score" style="color:#007AFF; font-size:18px; font-weight:bold;">--</span></div>
    <div class="metric-cell"><span class="metric-label" style="font-size:10px; color:#666;">Win Prob</span><span class="metric-value" id="ind-prob">--%</span></div>
</div>

        <aside class="right-panel" style="display:flex; flex-direction:column; gap:12px;">
            <div class="right-sub-panel" style="flex:1;">
                <div class="panel-header" style="padding:12px 16px; font-size:11px; font-weight:700; color:#6E6E73; border-bottom:1px solid rgba(0,0,0,0.08); display:flex; justify-content:space-between;">
                    <span>Sniper Signals</span>
                    <i class="fa-solid fa-crosshairs" style="color: var(--red-accent);"></i>
                </div>
                <div id="signal-feed-container"></div>
            </div>
            
            <div class="right-sub-panel" style="flex:1;">
                <div class="panel-header" style="padding:12px 16px; font-size:11px; font-weight:700; color:#6E6E73; border-bottom:1px solid rgba(0,0,0,0.08); display:flex; justify-content:space-between;">
                    <span>Trader Chat</span>
                    <i class="fa-solid fa-comments" style="color: var(--blue-accent);"></i>
                </div>
                <div id="community-feed-container"></div>
                <form id="post-form" class="chat-input-area" onsubmit="return false;" style="padding:10px; border-top:1px solid rgba(0,0,0,0.08); display:flex; gap:8px;">
                    <input type="text" class="chat-input" placeholder="Message..." style="flex:1; padding:8px; border-radius:8px; border:1px solid #ddd;">
                    <button id="post-submit-btn" class="chat-btn" style="width:32px; background:#007AFF; color:white; border:none; border-radius:8px;"><i class="fa-solid fa-arrow-up"></i></button>
                </form>
            </div>
        </aside>

    </div>

    <script type="module" src="{{ url_for('static', filename='js/sts.js') }}"></script>

</body>
</html>